# -*- coding: utf-8 -*-
"""stage1: Petrol Demand Forecasting Dataset Cleaning.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ARADfv3lPcES35D9O26Es4EG9ArA6JKs

**Petrol Demand Forecasting keyboardarrowdown Dataset Cleaning**

This notebook demonstrates how to handle date parsing errors and clean a dataset with missing values
"""

import pandas as pd
data=pd.read_csv("/content/Retail_Dataset.csv")
df = pd.DataFrame(data)
print('Before Cleaning:')
print(df.info())
df.head(20)

# Convert Date column to datetime automatically detecting mixed formats
df['Date'] = pd.to_datetime(df['Date'], errors='coerce', infer_datetime_format=True)
print('After Date Conversion:')
print(df.info())
df.head(10)

# Check missing values
print('Missing values count:')
print(df.isnull().sum())

df['Date'].sample(20).tolist()

df['Date'] = df['Date'].dt.strftime('%Y-%m-%d')

print('Missing values count:')
print(df.isnull().sum())

print(df["Date"].tail(20))
print("Missing values after observing:", df["Date"].isna().sum())

"""Handling Missing Values with Date"""

# Assuming your DataFrame is named 'df' and the column is ' Date'
df['Date'] = pd.to_datetime(df['Date'], errors='coerce')

# To forward-fill missing dates
df['Date'].fillna(method='ffill', inplace=True)
# To backward-fill missing dates
# df['Date'].fillna(method='bfill', inplace=True)

print(df['Date'].dtype)
print(df['Date'].isnull().sum())

"""Handling keyboardarrowdown Missing Values

* Product_ID & Warehouse: Fill with forward fill/



* backward fill.
* Order_Demand: Fill with mean.
* Promo: Fill with mode.
* Petrol_Price: Interpolate missing values.
"""

df['Product_id'] = df['Product_id'].fillna(method='ffill')
df['Warehouse'] = df['Warehouse'].fillna(method='bfill')
#df['Order_Demand'] = df['Order_Demand'].fillna(df['Order_Demand'].mean())
df['Order_Demand'].fillna(method='ffill', inplace=True)
df['Promo'] = df['Promo'].fillna(df['Promo'].mode()[0])
#df['Petrol_Price'] = df['Petrol_Price'].interpolate()
df['Petrol_price'].fillna(method='ffill', inplace=True)
print('After Cleaning:')
print(df.info())
df.head()

"""Interpolation:

Interpolation methods, such as linear interpolation, can estimate missing values by drawing a straight line
between the surrounding known data points. This is often more accurate than simple forward-filling for
continuous data.

Example: df['petrol_price'].interpolate(method='linear', inplace=True)

"""

df['Petrol_price'].interpolate(method='linear', inplace=True)

df['Product_Code'] = df['Product_Code'].fillna(method='ffill')
df['Product_Category'] = df['Product_Category'].fillna(method='bfill')

df.isnull().sum()

# Save DataFrame to CSV
df.to_csv("cleaned_petrol_demand.csv", index=False)
print("CSV file saved successfully!")